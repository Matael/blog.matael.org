<!DOCTYPE html>
<html lang="en">
	<head>
			<title>Thinking at Random</title>
		<meta charset="utf-8" />


		<meta name="tags" content="arduino" />
		<meta name="tags" content="imported" />

		<link rel=stylesheet/less type=text/css media=screen href="/theme/css/style.css" />
		<link rel=stylesheet type=text/css media=screen href="/theme/css/pygment.css" />
		<script src="/theme/js/less.min.js"></script>
	</head>

	<body>
		<div id=logo><div id=logo-wrapper>
			<header>
				<h1><a href="/"<span class=overbar><span class=big>t</span>hinking <span class=accent>at</span> <span class=big>r</span>andom</span></a></h1>
			</header>
			<nav>
				<ul>
					<li><a href="/">Writing</a></li>
					<li><a href="https://github.com/Matael">Github</a></li>
					<li><a href="https://matael.org">About</a></li>
				</ul>
			</nav>
		</div></div>
		<div id=page>
<section id=content>
	<header>
		<h1>Horloge Binaire Powaa</h1>
		
	</header>
	<article>

	<div id=meta>
		<p class=by-line>Published by 
				<a href="/author/matael.html" class=author>matael</a>
		</p>
		<p>On <time datetime="2015-01-04T11:20:57+01:00">Sun 04 January 2015</span></p>
		<ul class=tags>
				<li><a href="/tag/arduino.html">arduino</a></li>
				<li><a href="/tag/imported.html">imported</a></li>
		</ul>
	</div>
	<div id=article_body>
		<p>Entre deux plages de boulot, je me suis décidé à bidouiller une
<strong>horloge binaire</strong> avec l'arduino et une poignée de LEDS. Mieux encore,
elle est équipée d'une <strong>alarme</strong> !</p>
<div class="section" id="avant">
<h2>Avant</h2>
<p>C'est donc en triturant un peu l'arduino que je me suis dit que ce
serait cool de faire une <strong>horloge</strong> avec !</p>
<p>Voilà à quoi ça ressemble une fois fini :</p>
<p><img alt="En fonctionnement" src="/static/images/horloge_binaire/PIC_0005.JPG" style="width: 600px;" /></p>
<div class="section" id="comment-calculer-le-temps">
<h3>Comment calculer le temps</h3>
<p>Ça été (logiquement) le premier dilemme à résoudre sans quoi, aucune
<strong>horloge</strong> n'aurait pu fonctionner. Il faut savoir (si vous avez lu la
doc, ça ne devrait pas poser de problème) qu'il existe la fonction
<tt class="docutils literal">millis()</tt> qui renvoie le <strong>nombre de millis secondes écoulées depuis
la mise sous tension</strong> de l'arduino. Plutot sympa non ?</p>
</div>
<div class="section" id="comment-afficher-l-heure">
<h3>Comment afficher l'heure</h3>
<p>Là, j'ai un peu spoilé.... Avec des LEDs bien sûr, présenté en binaire.
Et pour le code : à grands coups de division et de modulo ! On affichera
les heures sur 5 bits et les minutes sur 6.</p>
<p>Le principe est simple :</p>
<div class="highlight"><pre><span></span><span class="c1">// variables pour les numéros de pins</span>
<span class="c1">// vu que c&#39;est pour l&#39;exemple,</span>
    <span class="c1">// j&#39;initialise les variables sans valeur...</span>
<span class="c1">// heures</span>
<span class="kt">int</span> <span class="n">h1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h4</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h8</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h16</span><span class="p">;</span>
<span class="c1">// minutes</span>
<span class="kt">int</span> <span class="n">m1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m4</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m8</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m16</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m32</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">heures</span> <span class="o">=</span> <span class="n">NOMBRE_HEURES</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">heures_restantes</span><span class="p">;</span>
<span class="c1">// affichage des heures</span>
<span class="k">if</span> <span class="p">((</span><span class="n">heures</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h16</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">16</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h16</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
<span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h8</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">8</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h8</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
<span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">4</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
<span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">2</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
<span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">1</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>

<span class="c1">// même principe pour les minutes...</span>
</pre></div>
<p>Voilà donc pour l'affichage.</p>
<div class="section" id="mais-une-alarme-ce-serait-cool">
<h4>Mais ! Une alarme, ce serait cool !</h4>
<p>Allons y pour une alarme ! On utilisera une LED de plus, raccordée à une
pin libre, que l'on oubliera (évidement) pas de déclarer en
<strong>output</strong>...</p>
<p>Pour ce qui est de l'alarme, voilà mon bout de code :</p>
<div class="highlight"><pre><span></span><span class="c1">// Règlage de l&#39;Alarme</span>
<span class="cp">#define AL_H 15   </span><span class="c1">// heures</span>
<span class="cp">#define AL_M 30   </span><span class="c1">// minutes</span>

<span class="c1">// [...]</span>

<span class="c1">//    Alarme</span>
<span class="kt">int</span> <span class="n">alarmeSet</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">AL_H</span><span class="p">,</span> <span class="n">AL_M</span><span class="p">};</span>

<span class="c1">// [...]</span>

<span class="kt">void</span> <span class="nf">alarm</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// --- Vérifie si c&#39;est l&#39;heure et déclenche l&#39;alarme</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures</span> <span class="o">==</span> <span class="n">alarmeSet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">minutes</span> <span class="o">==</span> <span class="n">alarmeSet</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="n">secondes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Ensuite, il ne nous reste qu'a appeler la fonction <tt class="docutils literal">alarm()</tt> à chaque
incrémentation des secondes, minutes et/ou heures. <strong>*Note*</strong> : il n'y
avait aucune raison <em>valable</em> d'utiliser un tableau pour les règlages de
l'alarme (<tt class="docutils literal">alarmeSet</tt>), mais j'avais envie...</p>
</div>
<div class="section" id="super-mais-la-led-elle-reste-allumee-la">
<h4>Super mais la LED elle reste allumée là !</h4>
<p>Pour ça, y'a un moyen tout simple : le bouton ! J'ai choisi de gérer le
bouton d'arrêt d'alarme avec une interruption, mais j'aurais pu utiliser
un simple <tt class="docutils literal">digitalRead()</tt> dans la <tt class="docutils literal">loop()</tt>. Je détaillerais dans un
autre article l'usage des interruptions, pour l'instant contentez vous
de savoir que la fonction d'arrêt ressemble à ça :</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">stop_alarme</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// --- Arrête l&#39;alarme</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>Trivial hein ?!</p>
<p>Et qu'elle sera appelée à chaque appui sur le bouton grâce à ces deux
lignes dans la <tt class="docutils literal">setup()</tt> :</p>
<div class="highlight"><pre><span></span><span class="c1">// bouton en input</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">on_off</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="c1">// interruption</span>
<span class="n">attachInterrupt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_alarme</span><span class="p">,</span> <span class="n">RISING</span><span class="p">);</span>
</pre></div>
<p>Et voilà pour l'alarme !</p>
</div>
<div class="section" id="brochage">
<h4>Brochage</h4>
<p>Petit schéma de brochage sur une breadboard avec le logiciel Fritzing
Alpha :</p>
<p><img alt="schéma de brochage" src="/static/images/horloge_binaire/schema.png" style="width: 600px;" />
Les LEDs utilisées sont des 3mm, les résistances sont en 220Ohms pour les
LEDs et en 470Ohms. Le bouton est un poussoir des plus classiques...</p>
<p>Attention toutefois : sur ce schéma, la plaque est mise à l'envers et se
lit donc de droite à gauche... Au niveau des broches :</p>
<ul class="simple">
<li>pin 0 : Alarme</li>
<li>pin 1 : Trotteuse</li>
<li>pin 2 : Bouton poussoir</li>
<li>pin 3 à 7 : Leds des heures</li>
<li>pin 8 à 13 : Leds des minutes</li>
</ul>
</div>
<div class="section" id="un-peu-de-lecture">
<h4>Un peu de lecture</h4>
<p>Pour comprendre comment lire tout ça, voilà une petite image :</p>
<p><img alt="Explication pour la lecture" src="/static/images/horloge_binaire/PIC_0009.JPG" style="width: 600px;" />
Le code
=======</p>
<p>Comme promis, voici le code complet :</p>
<div class="highlight"><pre><span></span><span class="c1">////////////////////////////</span>
<span class="c1">// Horloge Binaire        //</span>
<span class="c1">// Le 26 juillet 2011     //</span>
<span class="c1">// pour blog.matael.org   //</span>
<span class="c1">////////////////////////////</span>

<span class="c1">// L&#39;heure est à règler ici</span>
<span class="cp">#define HEURES 13</span>
<span class="cp">#define MINUTES 41</span>
<span class="cp">#define SECONDES 0</span>

<span class="c1">// Règlage de l&#39;Alarme</span>
<span class="cp">#define AL_H 15   </span><span class="c1">// heures</span>
<span class="cp">#define AL_M 30   </span><span class="c1">// minutes</span>


<span class="c1">// Variables</span>
<span class="c1">//    HMS</span>
<span class="kt">int</span> <span class="n">heures</span> <span class="o">=</span> <span class="n">HEURES</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">minutes</span> <span class="o">=</span> <span class="n">MINUTES</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">secondes</span> <span class="o">=</span> <span class="n">SECONDES</span><span class="p">;</span>

<span class="c1">//    Alarme</span>
<span class="kt">int</span> <span class="n">alarmeSet</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">AL_H</span><span class="p">,</span> <span class="n">AL_M</span><span class="p">};</span>

<span class="c1">//    Calcul du temps</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Etat de la trotteuse</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">trotteuseState</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="c1">// Pins</span>
<span class="c1">//    Heures</span>
<span class="kt">int</span> <span class="n">h1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h2</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h4</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h8</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">h16</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="c1">//    Minutes</span>
<span class="kt">int</span> <span class="n">m1</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m2</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m4</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m8</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m16</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">m32</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="c1">// Secondes</span>
<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>      <span class="c1">// Led trotteuse</span>
<span class="c1">// On/off</span>
<span class="kt">int</span> <span class="n">on_off</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// Bouton pour stoper l&#39;alarme</span>
<span class="c1">// alarme</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">alarme</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// led d&#39;alarme</span>


<span class="kt">void</span> <span class="nf">affichage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">minutes_restantes</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">heures_restantes</span><span class="p">;</span>
    <span class="c1">// Affichage des heures</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h16</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">16</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h16</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h8</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">8</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h8</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">4</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">2</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures_restantes</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">heures_restantes</span> <span class="o">=</span> <span class="n">heures</span><span class="o">%</span><span class="mi">1</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>

    <span class="c1">// Affichage des minutes</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes</span><span class="o">/</span><span class="mi">32</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m32</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">32</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m32</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes_restantes</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m16</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">16</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m16</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes_restantes</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m8</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">8</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m8</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes_restantes</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">4</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes_restantes</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">2</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">minutes_restantes</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">minutes_restantes</span> <span class="o">=</span> <span class="n">minutes</span><span class="o">%</span><span class="mi">1</span><span class="p">;}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">trotteuse</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// --- Fait clignoter la trotteuse toutes les secondes</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">stop_alarme</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// --- Arrête l&#39;alarme</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">alarm</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// --- Vérifie si c&#39;est l&#39;heure et déclenche l&#39;alarme</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">heures</span> <span class="o">==</span> <span class="n">alarmeSet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">minutes</span> <span class="o">==</span> <span class="n">alarmeSet</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="n">secondes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// pin Output</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">h8</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">h16</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">m8</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">m16</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">m32</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="c1">// bouton</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">on_off</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
    <span class="c1">// initialisation de la trotteuse</span>
        <span class="c1">// et de l&#39;alarme</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">alarme</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="c1">// Mise en place de l&#39;interruption pour</span>
        <span class="c1">// l&#39;arrêt de l&#39;alarme</span>
    <span class="n">attachInterrupt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_alarme</span><span class="p">,</span> <span class="n">RISING</span><span class="p">);</span>
    <span class="c1">// premier affichage</span>
    <span class="n">affichage</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">millis</span><span class="p">())</span> <span class="o">-</span> <span class="n">last</span>  <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
        <span class="n">trotteuse</span><span class="p">();</span> <span class="c1">// fait clignoter la trotteuse</span>
        <span class="n">secondes</span><span class="o">++</span><span class="p">;</span>  <span class="c1">// Incrémentation des secondes</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">secondes</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">minutes</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 60 secondes : +1 minute</span>
            <span class="n">secondes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">minutes</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">heures</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 60 minutes : +1 heure</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">heures</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">){</span>
            <span class="n">heures</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// changement de jour</span>
        <span class="p">}</span>
        <span class="n">alarm</span><span class="p">();</span> <span class="c1">// Vérification pour l&#39;alarme</span>
        <span class="n">affichage</span><span class="p">();</span> <span class="c1">// affichage de l&#39;heure</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>La flemme de copier/coller le code ? Télécharge le <a class="reference external" href="/static/files/horloge_binaire/horloge.pde">ici</a> !</p>
</div>
</div>
</div>
<div class="section" id="ameliore-moi-ca">
<h2>Améliore moi ça !!</h2>
<p>Tout le code que j'ai publié dans cet article est sous license
<a class="reference external" href="http://sam.zoy.org/wtfpl/">WTFPL</a>&gt;`_ et que par conséquent, <strong>vous
pouvez l'utiliser absolument comme vous voulez !</strong></p>
<p>Voilà donc quelques améliorations possibles :</p>
<div class="section" id="trotteuse">
<h3>Trotteuse</h3>
<p>Après quelque jours d'utilisation de l'horloge (et de l'alarme) je me
suis rendu compte que cette trotteuse était vraiment chiante
au possible et méga casse-burnes, euh... <em>insupportable</em> !</p>
<p>Ce serait pas une mauvaise idée de la virer !</p>
</div>
<div class="section" id="alarme">
<h3>Alarme</h3>
<p>A propos d'alarme : si vous avez testé le tout, vous aurez vu qu'a moins
de caler la LED d'alarme à cheval sur vos lunettes, on la voit pas bien.
Plusieurs solutions:</p>
<ul class="simple">
<li>Mettre une plusieurs LEDs</li>
<li>Essayer d'utiliser un petit HP avec un son super chiant (type buzzer)</li>
<li>Faire clignoter cette alarme en externe : genre avec un signal
d'horloge, une porte AND et la LED en bout, ou autre chose hein !</li>
<li>etc...</li>
</ul>
<p>A vous de tester !</p>
<p>L'autre amélioration possible concerne le code. Pour optimiser un peu et
éviter l'appel à une fonction (<tt class="docutils literal">alarm()</tt> ici), on aurait pu rajouter
une variable <tt class="docutils literal">alarmState</tt> et n'appeller la fonction que si cette
variable était à 0.</p>
</div>
<div class="section" id="reglage-de-l-heure-de-l-alarme">
<h3>Règlage de l'heure, de l'alarme</h3>
<p>Vous vous sentez en forme ?</p>
<p>Pourquoi ne pas essayer de faire un petit système de règlage de l'heure
avec des potars (sur le port analogique) par exemple. On peut étendre ça
à l'alarme aussi !</p>
<p>PS : Bonne chance pour celui là !</p>
</div>
<div class="section" id="changement-de-brochage">
<h3>Changement de brochage</h3>
<p>La même qu'avant, mais avec des rangées de résistances DIP :</p>
<p>Avant/Après :</p>
<p><img alt="Résistances séparées" src="/static/images/horloge_binaire/PIC_0004.JPG" style="width: 600px;" /> <img alt="Résistances DIP" src="/static/images/horloge_binaire/PIC_0017.JPG" style="width: 600px;" />
Vous pourrez voir en même temps le branchement du bouton.</p>
</div>
</div>
<div class="section" id="conclusion-en-carton">
<h2>Conclusion en carton</h2>
<p>Voilà, c'est (presque) fini pour l'horloge binaire : rien de très
sorcier donc. Je vous dit <em>&quot;presque fini&quot;</em> parce que si j'ai encore du
temps à perdre, j'essairai d'améliorer un peu (notamment le système de
setup pour l'horloge/l'alarme).</p>
<p>En espérant que cet article vous aura à peu près plut ! <em>(pas facile à
dire ça...)</em></p>
</div>

	</article>
</section>
		</div>
		<div class=clear>&nbsp;</div>
		<footer>
			<p id=legal>Proudly powered by Pelican &mdash; 2017 &mdash; Mathieu (matael) Gaborit</p>
		</footer>
	</body>
</html>