<!DOCTYPE html>
<html lang="en">
	<head>
			<title>Thinking at Random</title>
		<meta charset="utf-8" />


		<meta name="tags" content="Python" />
		<meta name="tags" content="django" />
		<meta name="tags" content="imported" />

		<link rel=stylesheet/less type=text/css media=screen href="/theme/css/style.css" />
		<link rel=stylesheet type=text/css media=screen href="/theme/css/pygment.css" />
		<script src="/theme/js/less.min.js"></script>
	</head>

	<body>
		<div id=logo><div id=logo-wrapper>
			<header>
				<h1><a href="/"<span class=overbar><span class=big>t</span>hinking <span class=accent>at</span> <span class=big>r</span>andom</span></a></h1>
			</header>
			<nav>
				<ul>
					<li><a href="/">Writing</a></li>
					<li><a href="https://github.com/Matael">Github</a></li>
					<li><a href="https://matael.org">About</a></li>
				</ul>
			</nav>
		</div></div>
		<div id=page>
<section id=content>
	<header>
		<h1>Photologue et ses dépendances</h1>
		
	</header>
	<article>

	<div id=meta>
		<p class=by-line>Published by 
				<a href="/author/matael.html" class=author>matael</a>
		</p>
		<p>On <time datetime="2015-01-04T11:28:38+01:00">Sun 04 January 2015</span></p>
		<ul class=tags>
				<li><a href="/tag/python.html">Python</a></li>
				<li><a href="/tag/django.html">django</a></li>
				<li><a href="/tag/imported.html">imported</a></li>
		</ul>
	</div>
	<div id=article_body>
		<div class="section" id="django">
<h2>Django</h2>
<p>J'ai un fort penchant pour <a class="reference external" href="http://www.python.org/">Python</a>, et quand il s'agit de développement web, plusieurs choix s'ouvrent :</p>
<ul class="simple">
<li>laisser Python de côté au profit de PHP</li>
<li>utiliser un micro-framework comme <a class="reference external" href="http://bottlepy.org/docs/dev/">Bottle</a></li>
<li>sortir la grosse Bertha : <a class="reference external" href="https://www.djangoproject.com/">Django</a></li>
</ul>
<p>Lorsque les sites commencent à prendre un peu d'ampleur, Django devient une excellente base : le développement est rapide et fiable.
De plus, l'utilisation d'un langage comme Python permet d'avoir un code clair et facile à lire (&lt;troll&gt;l'inverse de PHP quoi.... &lt;/troll&gt;).
Finalement, je trouve que leur devise leur va bien :</p>
<blockquote>
The Web framework for perfectionists with deadlines</blockquote>
</div>
<div class="section" id="photologue">
<h2>Photologue</h2>
<p>A l'image de Python en général, Django dispose d'excellents modules et, en ce qui concerne la gestion des photos, je me suis largement penché vers <a class="reference external" href="http://code.google.com/p/django-photologue/">Photologue</a>.</p>
<p>Pour un récent site, j'ai eu besoin de photologue et là, un problème (que je n'avais jamais eu est apparu) : de temps à autres, les pages avec des photos ne se chaargeaient pas correctement et m'affichaient une belle erreur</p>
<pre class="literal-block">
DatabaseError : la transaction est annulée, les commandes sont
    ignorées jusqu'à la fin du bloc de la transaction
</pre>
<p>J'ai un peu buté sur le bug : c'était la première fois qu'un truc comme ça foirait...</p>
<p>Un petit tour dans les logs m'a appris ce que je voulais</p>
<pre class="literal-block">
2012-05-21 18:42:25 CEST ERREUR:  la relation « tagging_tag » n'existe pas au caractère 88
2012-05-21 18:42:25 CEST INSTRUCTION :
    SELECT DISTINCT &quot;tagging_tag&quot;.id, &quot;tagging_tag&quot;.name
    FROM
        &quot;tagging_tag&quot;
        INNER JOIN &quot;tagging_taggeditem&quot;
            ON &quot;tagging_tag&quot;.id = &quot;tagging_taggeditem&quot;.tag_id
        INNER JOIN &quot;photologue_photo&quot;
            ON &quot;tagging_taggeditem&quot;.object_id = &quot;photologue_photo&quot;.&quot;id&quot;

    WHERE &quot;tagging_taggeditem&quot;.content_type_id = 11

    GROUP BY &quot;tagging_tag&quot;.id, &quot;tagging_tag&quot;.name

    ORDER BY &quot;tagging_tag&quot;.name ASC
2012-05-21 18:42:26 CEST ERREUR:  la transaction est annulée, les commandes sont ignorées jusqu'à la fin du bloc
de la transaction
</pre>
</div>
<div class="section" id="tagging">
<h2><tt class="docutils literal">tagging</tt></h2>
<p>Tiens, revoilà la phrase qui nous embêtait... mais là, deuxième problème : photologue peut travailler seul, en tant que galerie d'images dans une instance Django, et peut aussi utiliser des tags (soit en plain text, soit via le module <a class="reference external" href="http://code.google.com/p/django-tagging">django-tagging</a>).
En aucun cas ce module n'est obligatoire...</p>
<p>Là par contre, on dirait qu'il fouille dans une table qui aurait été crée par ce module et, ne la trouvant pas, qu'il fait la tête.</p>
<p>Un petit <tt class="docutils literal">sudo pip isntall <span class="pre">django-tagging</span></tt> m'apprend que ce module est bien installé, dans le doute, je décide de le mettre à jour :</p>
<div class="highlight"><pre><span></span>sudo pip install --upgrade django-tagging
</pre></div>
<p>La mise à jour se fait sans soucis, mais le site ne marche pas mieux...</p>
<p>Je me dis que le plus simple, ce serait de créer cette foutue table, sans rien y mettre, mais qu'elle existe.
Ainsi, j'ajoute <tt class="docutils literal">tagging</tt> à mes <tt class="docutils literal">INSTALLED_APPS</tt> et je met à jour ma DB :</p>
<div class="highlight"><pre><span></span>python manage.py syncdb
sudo service apache2 reload <span class="c1"># au cas où</span>
</pre></div>
<p>Et là ? ben tout va bien.</p>
<p>En fait, photologue essaie d'importer <tt class="docutils literal">tagging</tt> et, s'il y parvient, se comporte comme si celui ci avait été ajouté au site.
Le moyen le plus propre de faire aurait été de modifier le code de photologue pour qu'il n'utilise les tables de <tt class="docutils literal">tagging</tt> que si celui ci était dans les <tt class="docutils literal">INSTALLED_APPS</tt> mais là, fallait que je rush...</p>
<p>Voilà donc un article court qui, s'il avait été écrit avant m'aurait évité de chercher une solution plus longtemps...</p>
<p>Bonne soirée !</p>
</div>

	</article>
</section>
		</div>
		<div class=clear>&nbsp;</div>
		<footer>
			<p id=legal>Proudly powered by Pelican &mdash; 2017 &mdash; Mathieu (matael) Gaborit</p>
		</footer>
	</body>
</html>