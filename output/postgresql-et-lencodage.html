<!DOCTYPE html>
<html lang="en">
	<head>
			<title>Thinking at Random</title>
		<meta charset="utf-8" />


		<meta name="tags" content="postgresql" />
		<meta name="tags" content="imported" />

		<link rel=stylesheet/less type=text/css media=screen href="/theme/css/style.css" />
		<link rel=stylesheet type=text/css media=screen href="/theme/css/pygment.css" />
		<script src="/theme/js/less.min.js"></script>
	</head>

	<body>
		<div id=logo><div id=logo-wrapper>
			<header>
				<h1><a href="/"<span class=overbar><span class=big>t</span>hinking <span class=accent>at</span> <span class=big>r</span>andom</span></a></h1>
			</header>
			<nav>
				<ul>
					<li><a href="/">Writing</a></li>
					<li><a href="https://github.com/Matael">Github</a></li>
					<li><a href="https://matael.org">About</a></li>
				</ul>
			</nav>
		</div></div>
		<div id=page>
<section id=content>
	<header>
		<h1>PostGreSQL et l'encodage</h1>
		
	</header>
	<article>

	<div id=meta>
		<p class=by-line>Published by 
				<a href="/author/matael.html" class=author>matael</a>
		</p>
		<p>On <time datetime="2015-01-04T11:27:47+01:00">Sun 04 January 2015</span></p>
		<ul class=tags>
				<li><a href="/tag/postgresql.html">postgresql</a></li>
				<li><a href="/tag/imported.html">imported</a></li>
		</ul>
	</div>
	<div id=article_body>
		<p>Lorsque j'ai installé ce serveur, je suis allé un peu vite et j'ai pas vraiment fouillé la configuration de chaque composant.</p>
<p>Ajourd'hui, plus d'un an après, je me rends compte que, sur <a class="reference external" href="http://www.postgresql.org/">PostGreSQL</a> au moins, il aurait fallu faire attention.</p>
<div class="section" id="le-probleme">
<h2>Le problème</h2>
<p>Lors de l'installation, Postgres c'est automatiquement mis en LATIN1 pour l'encodage.</p>
<p>Rien de bien grave me direz vous sauf que certains symboles ne sont pas reconnus (le symbole de l'euro par exemple).</p>
<p>Lors du déploiement d'un site professionnel sur ce serveur, j'ai eu besoin d'une base de donnée encodée en utf8, et là, problème.</p>
<p>Ayant purement et simplement horreur du SQL (et n'y connaissant que le minimum syndical), j'ai essayé un truc comme ça :</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">MaBase</span> <span class="k">ENCODING</span> <span class="s1">&#39;UTF8&#39;</span><span class="p">;</span>
</pre></div>
<p>J'y ai cru au début, pas longtemps, mais un peu.</p>
<p>La réponse ne se fit pas attendre:</p>
<pre class="literal-block">
Erreur SQL :

ERREUR:  l'encodage UTF8 ne correspond pas à la locale fr_FR
DETAIL:  Le paramètre LC_CTYPE choisi nécessite l'encodage LATIN1.

Dans l'instruction :
CREATE DATABASE MaBase ENCODING 'UTF8';
</pre>
<p>Pas cool...</p>
</div>
<div class="section" id="la-solution">
<h2>La solution</h2>
<p>Vu que je suis trop bête pour lire le manuel <strong>avant</strong> d'installer, je dois maintenant trouver une solution.</p>
<p>En cumulant plusieurs posts de plusieurs forums et le manuel de <tt class="docutils literal">createdb</tt>, j'arrive à ça :</p>
<div class="highlight"><pre><span></span>createdb -U mon_user -l fr_FR.UTF8 -E UTF8 MaBase
</pre></div>
<p>L'option <tt class="docutils literal"><span class="pre">-U</span></tt> permet de spécifier l'utilisateur avec lequel lancer la requête, <tt class="docutils literal"><span class="pre">-l</span></tt> permet de définir la langue et <tt class="docutils literal"><span class="pre">-E</span></tt> l'encodage.</p>
<p>Je me disais, <em>chic ! le problème est réglé !</em> et là:</p>
<pre class="literal-block">
createdb : la création de la base de données a échoué :
ERREUR:  le nouvel encodage (UTF8 est incompatible avec
l'encodage de la base de données modèle (LATIN1)
ASTUCE : Utilisez le même encodage que celui de la base
de données modèle, ou utilisez template0 comme modèle.
</pre>
<p>Ben en voilà un truc sympa : il me donne la solution, un coup de <tt class="docutils literal">man</tt> plus tard, je découvre l'option <tt class="docutils literal"><span class="pre">-T</span></tt> permettant de spécifier un modèle de DB.</p>
<p>Je retente donc avec ce nouveau paramètre :</p>
<div class="highlight"><pre><span></span>createdb -U mon_user -l fr_FR.UTF8 -E UTF8 MaBase -T template0
</pre></div>
<p>Et là, <strong>youpi</strong> ! Tout marche.</p>
<p>Ce n'était peut être rien, mais ce truc m'aura gonflé un moment.
Désormais, le site est en ligne et tout va bien !</p>
</div>
<div class="section" id="mais">
<h2>Mais...</h2>
<p>Il faut quand même savoir une chose, c'est que ce truc ne marche (à ma connaissance) qu'avec les versions &gt;8.4 de <a class="reference external" href="http://www.postgresql.org/">PostGreSQL</a>.
La possibilité de créer des bases d'encodages différent <em>à l'arrache</em> avait été supprimé car cela générait des conflits.</p>
<p>On peut de nouveau le faire, et c'est tant mieux.</p>
<p>Notez toutefois que si vous faites une installation toute neuve de Postgres et que vous utilisez <tt class="docutils literal">initdb</tt>, vous aurez alors le moyen de choisir <em>locale</em> et encodage, vous épargnant ainsi une jolie prise de tête.</p>
<p>Bonne chance pour la suite, et à bientot !</p>
</div>

	</article>
</section>
		</div>
		<div class=clear>&nbsp;</div>
		<footer>
			<p id=legal>Proudly powered by Pelican &mdash; 2017 &mdash; Mathieu (matael) Gaborit</p>
		</footer>
	</body>
</html>